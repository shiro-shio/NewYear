<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <title>2025 3D è·¨å¹´ç…™ç«ç§€</title>

    <!-- fireworks-jsï¼ˆ2D ç²’å­èƒŒæ™¯ï¼‰ -->
    <script src="https://unpkg.com/fireworks-js@2.x/dist/index.umd.js"></script>

    <!-- Three.jsï¼ˆ3D ç…™ç«ï¼‰ -->
    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>

    <style>
        :root {
            --bg: #000;
            --text: #fff;
            --panel-bg: rgba(255, 255, 255, 0.1);
        }

        body.light {
            --bg: #f0f0f0;
            --text: #000;
            --panel-bg: rgba(0, 0, 0, 0.1);
        }

        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: var(--bg);
            color: var(--text);
            font-family: sans-serif;
        }

        #fireworks-container {
            position: fixed;
            inset: 0;
            z-index: 1;
        }

        #ui-layer {
            position: relative;
            z-index: 10;
            height: 100%;
            padding: 20px;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .panel {
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 12px;
            pointer-events: auto;
        }

        #countdown {
            font-size: 3rem;
            text-align: center;
            margin-top: 40px;
        }

        .hidden {
            display: none !important;
        }

        button {
            cursor: pointer;
        }
    </style>
</head>

<body class="dark">

    <div id="fireworks-container"></div>

    <div id="ui-layer">
        <div id="countdown">00:00:00</div>

        <div class="panel" id="main-panel">
            <button onclick="toggleTheme()">åˆ‡æ›é»‘ / ç™½åº•</button>
            <button onclick="toggleUI()">éš±è—ä»‹é¢ (H)</button>
            <button onclick="manualLaunch()">æ‰‹å‹•æ”¾ç…™ç«</button>
            <br><br>

            æ™‚å€ï¼š
            <select id="timezone"></select>
            <br><br>

            è‡ªå‹•ç…™ç«ç§’æ•¸ï¼š
            <input type="number" id="duration" value="10" min="1" style="width:60px;">
        </div>
    </div>

    <script>
        /**********************
         * fireworks-js åˆå§‹åŒ–
         **********************/
        const fwContainer = document.getElementById("fireworks-container");
        const fireworks = new Fireworks.default(fwContainer, {
            autoresize: true,
            opacity: 0.5,
            acceleration: 1.05,
            friction: 0.97,
            gravity: 1.5,
            particles: 80,
            traceLength: 3,
            flicker: true,
            intensity: 30
        });

        /**********************
         * Three.js 3D ç…™ç«
         **********************/
        let scene, camera, renderer;
        let fireworks3D = [];

        function initThree() {
            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.z = 60;

            renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.domElement.style.position = "fixed";
            renderer.domElement.style.inset = 0;
            renderer.domElement.style.zIndex = 2;

            document.body.appendChild(renderer.domElement);
            animateThree();
        }

        function create3DFirework(type) {
            let geometry;

            // ä¸åŒå¹¾ä½•é€ å‹
            if (type === "heart") {
                geometry = new THREE.TorusKnotGeometry(6, 2, 100, 16);
            } else if (type === "star") {
                geometry = new THREE.IcosahedronGeometry(6);
            } else {
                geometry = new THREE.SphereGeometry(6, 32, 32);
            }

            const material = new THREE.PointsMaterial({
                color: new THREE.Color(`hsl(${Math.random() * 360},100%,60%)`),
                size: 0.6,
                transparent: true
            });

            const mesh = new THREE.Points(geometry, material);
            mesh.position.set(
                (Math.random() - 0.5) * 40,
                (Math.random() - 0.5) * 30,
                -20
            );

            scene.add(mesh);
            fireworks3D.push({ mesh, life: 120 });
        }

        function animateThree() {
            requestAnimationFrame(animateThree);

            fireworks3D.forEach((fw, i) => {
                fw.mesh.rotation.x += 0.01;
                fw.mesh.rotation.y += 0.02;
                fw.life--;

                if (fw.life <= 0) {
                    scene.remove(fw.mesh);
                    fireworks3D.splice(i, 1);
                }
            });

            renderer.render(scene, camera);
        }

        /**********************
         * å€’æ•¸è¨ˆæ™‚ï¼ˆä¿®æ­£ç‰ˆï¼‰
         **********************/
        function getNowTZ(tz) {
            return new Date(new Date().toLocaleString("en-US", { timeZone: tz }));
        }

        function updateTime() {
            const tz = timezone.value;
            const now = getNowTZ(tz);
            const target = new Date(now.getFullYear() + 1, 0, 1, 0, 0, 0);
            const diff = target - now;

            if (diff <= 0) {
                countdown.innerText = "ğŸ† HAPPY NEW YEAR ğŸ†";
                startAutoFireworks();
                return;
            }

            const h = String(Math.floor(diff / 3600000)).padStart(2, "0");
            const m = String(Math.floor(diff % 3600000 / 60000)).padStart(2, "0");
            const s = String(Math.floor(diff % 60000 / 1000)).padStart(2, "0");

            countdown.innerText = `${h}:${m}:${s}`;
        }

        /**********************
         * UI / æ“ä½œ
         **********************/
        function toggleTheme() {
            document.body.classList.toggle("light");
        }

        function toggleUI() {
            mainPanel.classList.toggle("hidden");
            countdown.classList.toggle("hidden");
        }

        function manualLaunch() {
            fireworks.launch(2);
            create3DFirework(["sphere", "heart", "star"][Math.floor(Math.random() * 3)]);
        }

        function startAutoFireworks() {
            const duration = durationInput.value * 1000;
            fireworks.start();

            const timer = setInterval(() => {
                create3DFirework(["sphere", "heart", "star"][Math.floor(Math.random() * 3)]);
            }, 300);

            setTimeout(() => {
                fireworks.stop();
                clearInterval(timer);
            }, duration);
        }

        /**********************
         * åˆå§‹åŒ–
         **********************/
        const timezone = document.getElementById("timezone");
        const countdown = document.getElementById("countdown");
        const mainPanel = document.getElementById("main-panel");
        const durationInput = document.getElementById("duration");

        ["Asia/Taipei", "UTC", "Asia/Tokyo", "America/New_York"].forEach(z => {
            timezone.add(new Option(z, z));
        });
        timezone.value = "Asia/Taipei";

        initThree();
        setInterval(updateTime, 1000);

        window.addEventListener("keydown", e => {
            if (e.key.toLowerCase() === "h") toggleUI();
        });
    </script>

</body>
</html>
